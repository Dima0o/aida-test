
<!-- Подключение хедера -->
<? $this->includes('header'); ?>

<div style="padding-top: 20px;"></div>

<main role="main" class="container">
  <div class="row">
    <div class="col-md-8 blog-main">

      <div class="blog-post">
        <h3>Страница баланса</h3>

        <? if ( $this->GET[0] == 'needmoney' ): ?>

        <div class="alert alert-warning" role="alert">
          <strong>Внимание!</strong> Чтобы купить тест пополните баланс удобным вам способами
        </div>

        <? endif; ?>

        <table class="table table-bordered">
          <thead>
          <tr>
            <th>№ <?=count( $var['transactions'] )?></th>
            <th>Действие</th>
            <th>Сумма</th>
            <th>Дата</th>
          </tr>
          </thead>
          <tbody>

          <? if ( count( $var['transactions'] ) > 0 ): ?>

          <? foreach( $var['transactions'] as $item ): ?>

          <tr>
            <th scope="row"><?=$item['id']?></th>
            <td><span class="badge badge-success">Пополнение</span></td>
            <td><?=$item['amount']?></td>
            <td><?=date( 'd.m.Y h:m', $item['date'] )?></td>
          </tr>

          <? endforeach; ?>

          <? else: ?>

          <tr>
            <td colspan="4">Пополнения отсутствуют</td>
          </tr>

          <? endif; ?>

          <!--
          <tr>
              <th scope="row">3</th>
              <td><span class="badge badge-success">Пополнение</span></td>
              <td>300 р</td>
              <td>17.01.2018</td>
          </tr>
          -->

          </tbody>
        </table>

      </div>

    </div>

    <aside class="col-md-4 blog-sidebar">

      <div class="p-3 mb-3 bg-light rounded">
        <h4>Пополнить баланс</h4>
        <!---  <form action="https://money.yandex.ru/eshop.xml" method="post">

           <input name="shopId" value="506240" type="hidden"/>
                <input name="scid" value="730273" type="hidden"/>
            <input name="customerNumber" value="<?=$user->data['email']?>" type="hidden"/>
            <select name="sum" id="amount" class="form-control">
                    <option value="<?=$var['price']?>">1 тест: <?=$var['price']?> руб.</option>
                    <option value="<?=$var['price']*2?>">2 теста: <?=$var['price']*2?> руб.</option>
                    <option value="<?=$var['price']*3?>">3 теста: <?=$var['price']*3?> руб.</option>
                    <option value="<?=$var['price']*4?>">4 теста: <?=$var['price']*4?> руб.</option>
                    <option value="<?=$var['price']*5?>">5 тестов: <?=$var['price']*5?> руб.</option>
                    <option value="<?=$var['price']*6?>">6 тестов: <?=$var['price']*6?> руб.</option>
                    <option value="<?=$var['price']*7?>">7 тестов: <?=$var['price']*7?> руб.</option>
                    <option value="<?=$var['price']*8?>">8 тестов: <?=$var['price']*8?> руб.</option>
                    <option value="<?=$var['price']*9?>">9 тестов: <?=$var['price']*9?> руб.</option>
                    <option value="<?=$var['price']*10?>">10 тестов: <?=$var['price']*10?> руб.</option>
                    <option value="custom">Произвольная сумма</option>
                </select>
            Способ оплаты:<br>
            <input name="paymentType" value="PC" type="radio">Оплата из кошелька в Яндекс.Деньгах<br>
            <input name="paymentType" value="AC" type="radio">Оплата с произвольной банковской карты<br>
            <input name="paymentType" value="GP" type="radio">Оплата наличными через кассы и терминалы<br><br>
            <input type="submit" value="Заплатить"/>
            </form>
          -->

        <form action="https://money.yandex.ru/eshop.xml" method="post">
          <!-- Обязательные поля -->
          <input name="shopId" value="506240" type="hidden"/>
          <input name="scid" value="730273" type="hidden"/>
          <input name="customerNumber" value="<?=$user->data['email']?>" type="hidden"/><!-- сюда переменню генерируй-->
          <input name="customerContact" value="<?=$user->data['email']?>" type="hidden"/><!-- оставь-->
          <input name="orderNumber" value="abc1111111" type="hidden"/><!--Номер заказа сюда пиши что хочещ-->
          <input name="cps_phone" value="+79123456543" type="hidden"/>
          <input name="cps_email" value="user@domain.com" type="hidden"/>
          <input name="ym_merchant_receipt" value='{"customerContact": "+79001231212","taxSystem": 1, "items":[{"quantity": 1.154, "price": {"amount": 300.23},  "tax": 3,"text": "Зеленый чай \"Юн Ву\", кг"},{"quantity": 2,     "price": {"amount": 200.00},  "tax": 3,"text": "Кружка для чая, шт., скидка 10%"},{"quantity": 0.3,   "price": {"amount": 1000.00}, "tax": 3,"text": "Предоплата 30%, настольная игра \"Tea Time\""}]}'
                 type="hidden"/><!-- для статистики -->

          <div class="form-group">
            <label id="label_warning">Сумма </label>
            <select name="sum" id="amount" class="form-control">
              <option value="<?=$var['price']?>">1 тест: <?=$var['price']?> руб.</option>
              <option value="<?=$var['price']*2?>">2 теста: <?=$var['price']*2?> руб.</option>
              <option value="<?=$var['price']*3?>">3 теста: <?=$var['price']*3?> руб.</option>
              <option value="<?=$var['price']*4?>">4 теста: <?=$var['price']*4?> руб.</option>
              <option value="<?=$var['price']*5?>">5 тестов: <?=$var['price']*5?> руб.</option>
              <option value="<?=$var['price']*6?>">6 тестов: <?=$var['price']*6?> руб.</option>
              <option value="<?=$var['price']*7?>">7 тестов: <?=$var['price']*7?> руб.</option>
              <option value="<?=$var['price']*8?>">8 тестов: <?=$var['price']*8?> руб.</option>
              <option value="<?=$var['price']*9?>">9 тестов: <?=$var['price']*9?> руб.</option>
              <option value="<?=$var['price']*10?>">10 тестов: <?=$var['price']*10?> руб.</option>
              <option value="custom">Произвольная сумма</option>
            </select>
          </div>
          <input type="hidden" name="balance_add">
          <input type="submit" class="btn btn-sm btn-outline-success" value="Заплатить"/>

        </form>

      </div>

    </aside>

  </div>

</main>

<!-- Подключение футера -->
<? $this->includes('footer'); ?>

<script>

    $(document).ready(function() {

        //Появление и скрытие инпута
        $( "#amount" ).change(function() {
            var value = $(this).val();
            if ( value !== 'custom' ){
                $("#custom_input").css("display","none");
                $("#custom_amount").attr('disabled','disabled');
            }else{
                $("#custom_input").css("display","block");
                $("#custom_amount").removeAttr('disabled');
            }

        });

        //Отправка вормы
        $( "#button_submit" ).click(function() {

            var select = $( "#amount" ).val();

            if ( select == 'custom' ){
                var summa = $( "#custom_amount" ).val();
            }else {
                var summa = $( "#amount" ).val();
            }

            if ( summa > 49 ){
                //Отправка формы
                $( "#form_balance" ).submit();
            }else {
                //принт ошибки "менее 50 рублей"
                $('#warning').remove();
                $('#label_warning').append('<span class="badge badge-danger" id="warning">Не менее 50 рублей</span>');
            }

        });

        //Ввод в инпут только чисел
        $("#custom_amount").keydown(function(event) {
            // Разрешаем нажатие клавиш backspace, Del, Tab и Esc
            if ( event.keyCode == 46 || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 27 ||
                // Разрешаем выделение: Ctrl+A
                (event.keyCode == 65 && event.ctrlKey === true) ||
                // Разрешаем клавиши навигации: Home, End, Left, Right
                (event.keyCode >= 35 && event.keyCode <= 39)) {
                return;
            }else {
                // Запрещаем всё, кроме клавиш цифр на основной клавиатуре, а также Num-клавиатуре
                if ((event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105 )) {
                    event.preventDefault();
                }
            }
        });

    });

</script>